<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            touch-action: none;
        }
        canvas {
            touch-action: none;
        }
        </style>
    <canvas id="can"></canvas>

<!-- صدای برخورد -->
<audio id="hitSound" src="https://assets.mixkit.co/sfx/preview/mixkit-video-game-bubble-pop-2013.mp3"></audio>
<!-- موسیقی پس‌زمینه -->
<audio id="bgMusic" src="k.mp3" loop></audio>

<!-- پنجره گیم اور -->
<div id="gameOverBox" style="
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    padding: 30px;
    background: white;
    box-shadow: 0 0 20px black;
    font-size: 30px;
    text-align: center;
    display: none;
    border-radius: 15px;
">
    <p>GAME OVER!</p>
    <button id="okBtn" style="
        padding: 10px 25px;
        font-size: 22px;
        cursor: pointer;
        border-radius: 10px;
    ">OK</button>
</div>

<script>
let canvas = document.getElementById("can");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
let c = canvas.getContext("2d");

// ---------------- GAME VARIABLES ----------------
let gameOver = false;

// ---------------- BACKGROUND ----------------




function drawBackground() {
    let grd = c.createLinearGradient(0, 0, 0, canvas.height);
    grd.addColorStop(0, "#87CEFA");
    grd.addColorStop(1, "#E0FFFF");
    c.fillStyle = grd;
    c.fillRect(0, 0, canvas.width, canvas.height);

    // clouds
    c.fillStyle = "white";
    drawCloud(200, 120);
    drawCloud(600, 200);
    drawCloud(1000, 100);
}
function drawCloud(x, y) {
    c.beginPath();
    c.arc(x, y, 40, 0, Math.PI * 2);
    c.arc(x + 40, y + 10, 35, 0, Math.PI * 2);
    c.arc(x - 40, y + 10, 35, 0, Math.PI * 2);
    c.fill();
}

// ---------------- SOUND ----------------
let hitSound = document.getElementById("hitSound");

// ---------------- BACKGROUND MUSIC ----------------
let bgMusic = document.getElementById("bgMusic");

// فعال کردن موسیقی بعد از اولین کلیک
function enableBGMusic() {
    bgMusic.play().catch(()=>{});
    document.removeEventListener("click", enableBGMusic);
    document.removeEventListener("keydown", enableBGMusic);
}
document.addEventListener("click", enableBGMusic);
document.addEventListener("keydown", enableBGMusic);


// ---------------- KEYS ----------------

let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);
// ---------------- TOUCH CONTROLS ----------------
let touchLeft = false;
let touchRight = false;
let touchJump = false;

canvas.addEventListener("touchstart", e => {
    e.preventDefault();

    let touchX = e.touches[0].clientX;
    let touchY = e.touches[0].clientY;

    if (touchY < canvas.height * 0.6) {
        // پرش
        touchJump = true;
    } else if (touchX < canvas.width / 2) {
        // حرکت چپ
        touchLeft = true;
    } else {
        // حرکت راست
        touchRight = true;
    }
});

canvas.addEventListener("touchend", e => {
    touchLeft = false;
    touchRight = false;
    touchJump = false;
});

// ---------------- PLAYER HAND ----------------
let hand = {
    w: 120,
    h: 40,
    x: canvas.width / 2 - 60,
    y: canvas.height - 100,
    vy: 0,
    onGround: true
};

// ---------------- LEVEL SYSTEM ----------------
let level = 1;
let maxLevel = 5;
let balloonInterval = 2000;
let balloonSpeed = 1.1;

// ---------------- BALLOON CLASS ----------------
class Balloon {
    constructor() {
        this.r = 40;
        this.cx = Math.random() * (canvas.width - this.r*2) + this.r;
        this.cy = -Math.random() * 400;
        this.vy = balloonSpeed;
        this.color = "hsl(" + Math.random()*360 + ",70%,60%)";
    }

    draw() {
        c.save();
        c.translate(this.cx, this.cy);
        c.scale(1, 1.3);
        c.beginPath();
        c.fillStyle = this.color;
        c.arc(0, 0, this.r, 0, Math.PI * 2);
        c.fill();
        c.restore();

        c.beginPath();
        c.moveTo(this.cx, this.cy + this.r * 1.3);
        c.lineTo(this.cx, this.cy + this.r * 2);
        c.stroke();
    }

    update() {
        this.cy += this.vy;

        if (this.cy > canvas.height && !gameOver) {
            gameOver = true;
            showGameOver();
        }

        this.draw();
    }
}

// ---------------- BALLOON SPAWN ----------------
let balloons = [];
let spawnTimer = setInterval(() => {
    if (!gameOver)
        balloons.push(new Balloon());
}, balloonInterval);

// ---------------- LEVEL UP ----------------
setInterval(() => {
    if (level < maxLevel && !gameOver) {
        level++;
        balloonInterval -= 300;
        if (balloonInterval < 500) balloonInterval = 500;
        balloonSpeed += 0.5;
    }
}, 10000);

// ---------------- GAME LOOP ----------------
function animate() {
    if (gameOver) return;

    requestAnimationFrame(animate);

    drawBackground();

    // Move Hand

    // Move Hand (Keyboard + Touch)
if (keys["ArrowLeft"] || touchLeft) hand.x -= 25;
if (keys["ArrowRight"] || touchRight) hand.x += 25;

    // if (keys["ArrowLeft"]) hand.x -= 25;
    // if (keys["ArrowRight"]) hand.x += 25;
// جلوگیری از خروج بازیکن از صفحه
if (hand.x < 0) hand.x = 0;
if (hand.x + hand.w > canvas.width)
    hand.x = canvas.width - hand.w; 

    // Jump
// Jump (Keyboard + Touch)
if ((keys["ArrowUp"] || touchJump) && hand.onGround) {
    hand.vy = -15;
    hand.onGround = false;
}


    // if (keys["ArrowUp"] && hand.onGround) {
    //     hand.vy = -15;
    //     hand.onGround = false;
    // }

    hand.vy += 0.6;
    hand.y += hand.vy;

    if (hand.y + hand.h >= canvas.height - 30) {
        hand.y = canvas.height - hand.h - 30;
        hand.vy = 0;
        hand.onGround = true;
    }

    // Draw hand
    c.fillStyle = "brown";
    c.fillRect(hand.x, hand.y, hand.w, hand.h);

    // Update balloons
    balloons.forEach(b => {
        b.update();

        // Collision
        if (
            b.cx > hand.x &&
            b.cx < hand.x + hand.w &&
            b.cy + b.r > hand.y &&
            b.cy - b.r < hand.y + hand.h
        ) {
            b.vy = -6;
            hitSound.currentTime = 0;
            hitSound.play();
        }
    });
// فعال کردن صدا بعد از اولین کلیک یا فشار کلید


function enableSound() {
    hitSound.play().then(() => {
        hitSound.pause();
        hitSound.currentTime = 0;
        document.removeEventListener("click", enableSound);
        document.removeEventListener("keydown", enableSound);
    }).catch(()=>{});
}
document.addEventListener("click", enableSound);
document.addEventListener("keydown", enableSound);

    c.fillStyle = "black";
    c.font = "30px Arial";
    c.fillText("LEVEL: " + level, 30, 40);
}

animate();

// ---------------- GAME OVER BOX ----------------
function showGameOver() {
    bgMusic.pause();
    document.getElementById("gameOverBox").style.display = "block";
}



document.getElementById("okBtn").onclick = () => {
    resetGame();
};

// ---------------- RESET GAME ----------------
function resetGame() {
    gameOver = false;

    balloons = [];
    level = 1;
    balloonInterval = 2000;
    balloonSpeed = 1.1;

    hand.x = canvas.width / 2 - 60;
    hand.y = canvas.height - 100;
    hand.vy = 0;

    document.getElementById("gameOverBox").style.display = "none";

    bgMusic.currentTime = 0;  // از اول
    bgMusic.play().catch(()=>{});

    animate();
}





</script>



</body>
</html>





